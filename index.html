<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>PDF Master Tool ЁЯЪА</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* -------------------------------------- */
        /* 1. CSS Variables for Themes & Colors */
        /* -------------------------------------- */
        :root {
            /* Dark Theme (Default) */
            --bg: #0f1014;
            --bg-alt: #181a20;
            --accent: #2dd4ff; /* Sky Blue */
            --accent-soft: rgba(45, 212, 255, 0.1);
            --danger: #ef4444; /* Red */
            --success: #22c55e; /* Green */
            --text: #f9fafb;
            --muted: #9ca3af;
            --border: #272a33;
            --header-bg: rgba(2, 6, 23, 0.95);
            --sidebar-bg: #020617;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --card-bg: #0d101d;
            --drop-bg: #1f2937;
            --drop-hover-bg: #273343;
            --input-bg: #020617;

            /* Radii */
            --radius-lg: 16px;
            --radius-md: 10px;
            --radius-sm: 6px;
        }

        /* Light Theme Overrides */
        .light-theme {
            --bg: #f9fafb;
            --bg-alt: #ffffff;
            --accent: #0ea5e9;
            --accent-soft: rgba(14, 165, 233, 0.15);
            --danger: #dc2626;
            --success: #16a34a;
            --text: #111827;
            --muted: #6b7280;
            --border: #e5e7eb;
            --header-bg: rgba(255, 255, 255, 0.95);
            --sidebar-bg: #f3f4f6;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --card-bg: #ffffff;
            --drop-bg: #f3f4f6;
            --drop-hover-bg: #e5e7eb;
            --input-bg: #ffffff;
        }

        /* -------------------------------------- */
        /* 2. Base & Layout Styles */
        /* -------------------------------------- */

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }

        .app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* -------------------------------------- */
        /* 3. Header & Navigation */
        /* -------------------------------------- */

        .app-header {
            position: sticky;
            top: 0;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 18px;
            background: var(--header-bg);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(12px);
            transition: border-color 0.3s;
        }

        .app-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: linear-gradient(135deg, #0ea5e9, #2dd4ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
            color: white;
            box-shadow: 0 0 15px rgba(45, 212, 255, 0.5);
        }

        .title-text-main {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .title-text-sub {
            font-size: 0.75rem;
            color: var(--muted);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .layout {
            flex: 1;
            display: flex;
            min-height: 0;
        }

        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-inline-end: 1px solid var(--border);
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .sidebar-section-title {
            color: var(--muted);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 4px 10px;
            margin-top: 10px;
        }

        .nav-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            border-radius: var(--radius-md);
            color: var(--muted);
            cursor: pointer;
            transition: background 0.15s, color 0.15s, border 0.15s;
        }

        .nav-item:hover {
            background: var(--bg-alt);
            color: var(--text);
        }

        .nav-item.active {
            background: var(--accent-soft);
            color: var(--accent);
            border: 1px solid rgba(45, 212, 255, 0.3);
            font-weight: 600;
        }

        .nav-item span {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* -------------------------------------- */
        /* 4. Main Content & Components */
        /* -------------------------------------- */

        .main {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }

        .section {
            max-width: 1000px;
            margin: 0 auto;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .section-subtitle {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            box-shadow: var(--card-shadow);
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent);
        }

        .card-subtitle {
            font-size: 0.8rem;
            color: var(--muted);
        }

        /* -------------------------------------- */
        /* 5. Form & Button Elements */
        /* -------------------------------------- */

        .input-group, .stack {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text);
        }

        .input, .select {
            padding: 12px;
            border: 1px solid var(--border);
            background: var(--input-bg);
            color: var(--text);
            border-radius: var(--radius-sm);
            transition: border 0.2s, box-shadow 0.2s;
        }

        .input:focus, .select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-soft);
            outline: none;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s, opacity 0.2s;
            background: var(--accent);
            color: var(--bg);
        }

        .btn:hover:not(:disabled) {
            background: #0ea5e9;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-alt);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--border);
            color: var(--text);
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        /* -------------------------------------- */
        /* 6. File Drop & Lists */
        /* -------------------------------------- */

        .file-drop {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            border: 2px dashed var(--accent);
            border-radius: var(--radius-md);
            background: var(--drop-bg);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }

        .file-drop:hover, .file-drop.dragover {
            background: var(--drop-hover-bg);
            border-color: var(--accent);
        }
        
        .file-drop i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .file-drop-title {
            font-weight: 600;
        }

        .file-drop-sub {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 5px;
        }

        .file-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            padding: 10px;
            background: var(--bg-alt);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .file-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .file-meta {
            font-size: 0.75rem;
            color: var(--muted);
            display: flex;
            gap: 15px;
        }

        .file-progress-bar {
            height: 5px;
            background: var(--border);
            border-radius: 2.5px;
            overflow: hidden;
            margin-top: 5px;
        }

        .file-progress-bar div {
            height: 100%;
            width: 0%;
            background: var(--success);
            transition: width 0.3s;
        }
        
        /* -------------------------------------- */
        /* 7. Utilities and Status */
        /* -------------------------------------- */
        
        .status-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            padding: 6px 10px;
            border-radius: 50px;
            background: var(--bg-alt);
            border: 1px solid var(--border);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
            transition: background 0.3s;
        }

        .status-dot.online {
            background: var(--success);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Toast Notifications */
        #notification-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: var(--bg-alt);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 10px 15px;
            font-size: 14px;
            min-width: 250px;
            box-shadow: var(--card-shadow);
            opacity: 0;
            animation: slidein 0.5s forwards, slideout 0.5s 4.5s forwards;
        }
        .toast.success { border-inline-start: 4px solid var(--success); }
        .toast.error { border-inline-start: 4px solid var(--danger); }
        .toast.info { border-inline-start: 4px solid var(--accent); }

        @keyframes slidein {
            from { top: -50px; opacity: 0; }
            to { top: 0; opacity: 1; }
        }
        @keyframes slideout {
            0% { opacity: 1; }
            90% { opacity: 0; }
            100% { display: none; }
        }
        /* Mobile Adjustments */
        @media (max-width: 900px) {
            .sidebar { width: 100%; border-inline-end: none; border-bottom: 1px solid var(--border); padding-bottom: 8px; overflow-x: auto; }
            .nav-list { flex-direction: row; overflow-x: auto; }
            .nav-item { flex: 0 0 auto; min-width: 140px; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="app">
    <header class="app-header">
        <div class="app-title">
            <div class="logo"><i class="fas fa-file-pdf"></i></div>
            <div>
                <div class="title-text-main" data-i18n="appTitle">PDF Master Tool</div>
                <div class="title-text-sub" data-i18n="appSubtitle">┘Д┘И╪н╪й ╪к╪н┘Г┘Е ╪з╪н╪к╪▒╪з┘Б┘К╪й ┘Д┘Г┘Д ╪г╪п┘И╪з╪к ╪з┘Д┘А PDF</div>
            </div>
        </div>
        <div class="header-right">
            <button id="theme-toggle" class="btn-icon-round btn-secondary" aria-label="Toggle dark/light theme">
                <i id="theme-icon" class="fas fa-sun"></i>
            </button>
            <div class="lang-toggle">
                <button class="btn-sm btn-secondary lang-btn active" data-lang="ar">AR</button>
                <button class="btn-sm btn-secondary lang-btn" data-lang="en">EN</button>
            </div>
            <div class="status-pill">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Checking...</span>
            </div>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-section-title" data-i18n="navInfoTitle">╪н┘И┘Д ┘И╪г╪│╪з╪│┘К╪з╪к</div>
            <div class="nav-list">
                <div class="nav-item active" data-section="about"><span><i class="fas fa-info-circle"></i><span data-i18n="navAbout">╪н┘И┘Д ╪з┘Д╪г╪п╪з╪й</span></span></div>
                <div class="nav-item" data-section="compress"><span><i class="fas fa-compress-alt"></i><span data-i18n="navCompress">╪╢╪║╪╖ ╪з┘Д┘Е┘Д┘Б╪з╪к</span></span></div>
                <div class="nav-item" data-section="merge"><span><i class="fas fa-code-branch"></i><span data-i18n="navMerge">╪п┘Е╪м ╪з┘Д┘Е┘Д┘Б╪з╪к</span></span></div>
                <div class="nav-item" data-section="split"><span><i class="fas fa-cut"></i><span data-i18n="navSplit">╪к┘В╪│┘К┘Е / ╪з╪│╪к╪о╪▒╪з╪м ╪╡┘Б╪н╪з╪к</span></span></div>
                <div class="nav-item" data-section="text"><span><i class="fas fa-file-alt"></i><span data-i18n="navText">╪з╪│╪к╪о╪▒╪з╪м ╪з┘Д┘Ж╪╡</span></span></div>
                <div class="nav-item" data-section="info"><span><i class="fas fa-search"></i><span data-i18n="navInfo">┘Е╪╣┘Д┘И┘Е╪з╪к ╪з┘Д┘Е┘Д┘Б</span></span></div>
            </div>

            <div class="sidebar-section-title" data-i18n="navAdvanced">┘Е╪к┘В╪п┘С┘Е</div>
            <div class="nav-list">
                <div class="nav-item" data-section="protect"><span><i class="fas fa-lock"></i><span data-i18n="navProtect">╪н┘Е╪з┘К╪й / ┘Б┘Г ╪з┘Д╪н┘Е╪з┘К╪й</span></span></div>
                <div class="nav-item" data-section="watermark"><span><i class="fas fa-tint"></i><span data-i18n="navWatermark">╪з┘Д╪╣┘Д╪з┘Е╪й ╪з┘Д┘Е╪з╪ж┘К╪й</span></span></div>
                <div class="nav-item" data-section="rotate"><span><i class="fas fa-sync-alt"></i><span data-i18n="navRotate">╪к╪п┘И┘К╪▒ / ╪е╪╣╪з╪п╪й ╪к╪▒╪к┘К╪и</span></span></div>
            </div>

            <div class="sidebar-section-title" data-i18n="navSystem">╪з┘Д┘Е┘Д┘Б╪з╪к ┘И╪з┘Д┘Ж╪╕╪з┘Е</div>
            <div class="nav-list">
                <div class="nav-item" data-section="supabase"><span><i class="fas fa-database"></i><span data-i18n="navSupabase">╪е╪п╪з╪▒╪й ╪з┘Д┘Е┘Д┘Б╪з╪к</span></span></div>
                <div class="nav-item" data-section="history"><span><i class="fas fa-history"></i><span data-i18n="navHistory">╪з┘Д╪│╪м┘Д ┘И ╪з┘Д╪н╪з┘Д╪й</span></span></div>
            </div>
        </aside>

        <main class="main">
            <section id="section-about" class="section">
                <div class="section-header">
                    <div class="section-title" data-i18n="aboutTitle">╪н┘И┘Д PDF Master Tool</div>
                    <div class="section-subtitle">╪е╪╡╪п╪з╪▒ ╪в┘Е┘Ж ┘И┘Е╪н╪│┘С┘Ж | Mahmoud Hassan</div>
                </div>
                <div class="card">
                    <div class="card-body" style="line-height: 1.8;">
                        <h2 data-i18n="aboutWelcome" style="margin-top: 0;">┘Е╪▒╪н╪и╪з┘Л ╪и┘Г ┘Б┘К ╪г╪п╪з╪й PDF ╪з┘Д╪┤╪з┘Е┘Д╪й!</h2>
                        <p data-i18n="aboutGoal">┘З╪░┘З ╪з┘Д╪г╪п╪з╪й ┘Е╪╡┘Е┘Е╪й ┘Д╪к╪и╪│┘К╪╖ ╪м┘Е┘К╪╣ ┘Е┘З╪з┘Е ┘Е╪╣╪з┘Д╪м╪й ┘Е┘Д┘Б╪з╪к PDF╪М ┘Е┘Ж ╪з┘Д╪╢╪║╪╖ ╪е┘Д┘Й ╪з┘Д╪н┘Е╪з┘К╪й. ┘Ж╪╣╪к┘Е╪п ╪╣┘Д┘Й Supabase ┘Д╪к╪о╪▓┘К┘Ж ╪з┘Д┘Е┘Д┘Б╪з╪к ╪и╪┤┘Г┘Д ┘Е╪д┘В╪к ┘И┘Е┘П╪д┘Е┘Ж.</p>
                        <p data-i18n="aboutSecurity"><strong>╪к┘Ж╪и┘К┘З ┘З╪з┘Е ╪н┘И┘Д ╪з┘Д╪г┘Е╪з┘Ж:</strong> ┘З╪░╪з ╪з┘Д┘Г┘И╪п ┘К╪н╪к┘И┘К ╪╣┘Д┘Й ╪з┘Д┘Е┘Б╪к╪з╪н ╪з┘Д╪╣╪з┘Е (Anon Key) ┘И╪╣┘Ж┘И╪з┘Ж Supabase ┘Д╪к╪┤╪║┘К┘Д┘З ┘Г┘Е┘Д┘Б ┘И╪з╪н╪п. **┘Д╪з ╪к╪│╪к╪о╪п┘Е ┘З╪░╪з ╪з┘Д┘Е┘Б╪к╪з╪н ┘Б┘К ╪к╪╖╪и┘К┘В ╪е┘Ж╪к╪з╪м ┘Б╪╣┘Д┘К**╪М ╪и┘Д ┘К╪м╪и ╪з╪│╪к╪и╪п╪з┘Д┘З ╪и╪о╪з╪п┘Е ┘И╪│┘К╪╖ ┘Д╪е╪о┘Б╪з╪б ╪з┘Д┘Е┘Б╪к╪з╪н ╪з┘Д╪│╪▒┘К╪М ┘Д╪╢┘Е╪з┘Ж ╪н┘Е╪з┘К╪й ╪и┘К╪з┘Ж╪з╪к┘Г ┘И┘Е┘Ж╪╣ ╪з┘Д┘И╪╡┘И┘Д ╪║┘К╪▒ ╪з┘Д┘Е╪╡╪▒╪н ╪и┘З.</p>
                        <p data-i18n="aboutTip">┘Д╪к╪┤╪║┘К┘Д ╪з┘Д╪г╪п╪з╪й: ╪к╪г┘Г╪п ┘Е┘Ж ╪к╪н╪п┘К╪л ┘Е┘Б╪к╪з╪н ┘И╪╣┘Ж┘И╪з┘Ж Supabase ╪з┘Д╪о╪з╪╡ ╪и┘Г ┘Б┘К ┘В╪│┘Е `SUPABASE_CONFIG` ┘Б┘К ┘Г┘И╪п JavaScript ╪и╪з┘Д╪г╪│┘Б┘Д.</p>
                    </div>
                </div>
            </section>

            <section id="section-compress" class="section" style="display:none">
                <div class="section-header">
                    <div class="section-title" data-i18n="compressTitle">╪╢╪║╪╖ ┘Е┘Д┘Б╪з╪к PDF</div>
                    <div class="section-subtitle" data-i18n="compressSubtitle">╪к┘В┘Д┘К┘Д ╪н╪м┘Е ╪з┘Д┘Е┘Д┘Б╪з╪к ╪и╪м┘И╪п╪й ╪╣╪з┘Д┘К╪й</div>
                </div>
                <div class="grid">
                    <div class="card">
                        <div class="card-header"><div class="card-title" data-i18n="compressUploadTitle">╪▒┘Б╪╣ ┘И╪╢╪║╪╖ ╪з┘Д┘Е┘Д┘Б╪з╪к</div></div>
                        <div class="card-body stack">
                            <div id="compress-drop" class="file-drop" role="button" tabindex="0">
                                <i class="fas fa-upload"></i>
                                <div class="file-drop-title" data-i18n="compressDropTitle">╪з╪│╪н╪и ┘Е┘Д┘Б╪з╪к PDF ┘З┘Ж╪з ╪г┘И ╪з╪╢╪║╪╖ ┘Д┘Д╪з╪о╪к┘К╪з╪▒</div>
                                <div class="file-drop-sub" data-i18n="compressDropSub">╪│┘К╪к┘Е ╪з┘Д╪▒┘Б╪╣ ┘И╪з┘Д┘Е╪╣╪з┘Д╪м╪й ╪к┘Д┘В╪з╪ж┘К┘Л╪з</div>
                            </div>
                            <input type="file" id="compress-input" accept="application/pdf" multiple style="display:none">
                            <div class="file-list" id="compress-file-list"></div>
                        </div>
                    </div>
                    </div>
            </section>
            
            <section id="section-merge" class="section" style="display:none">
                <div class="section-header">
                    <div class="section-title" data-i18n="mergeTitle">╪п┘Е╪м ┘Е┘Д┘Б╪з╪к PDF</div>
                    <div class="section-subtitle" data-i18n="mergeSubtitle">╪з╪о╪к╪▒ ╪з┘Д┘Е┘Д┘Б╪з╪к ┘И┘В┘Е ╪и╪к╪▒╪к┘К╪и┘З╪з ╪л┘Е ╪п┘Е╪м┘З╪з</div>
                </div>
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" data-i18n="mergeLocalTitle">┘Е┘Д┘Б╪з╪к ╪з┘Д╪п┘Е╪м ╪з┘Д┘Е╪н╪п╪п╪й</div>
                            <button class="btn-sm btn-secondary" id="merge-add-file"><i class="fas fa-plus"></i></button>
                        </div>
                        <div class="card-body stack">
                            <input type="file" id="merge-input" accept="application/pdf" multiple style="display:none">
                            <div class="file-list" id="merge-file-list">
                                <div class="file-drop-sub" style="margin-top: 0;" data-i18n="mergeDropSub">╪з╪╢╪║╪╖ ╪╣┘Д┘Й (+) ┘Д╪е╪╢╪з┘Б╪й ┘Е┘Д┘Б╪з╪к ┘И┘В┘Е ╪и╪│╪н╪и ┘И╪е┘Б┘Д╪з╪к ┘Д╪е╪╣╪з╪п╪й ╪к╪▒╪к┘К╪и┘З╪з.</div>
                            </div>
                            <button class="btn" id="merge-btn" type="button" disabled>
                                <i class="fas fa-code-branch"></i> <span data-i18n="btnMerge">╪п┘Е╪м ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪н╪п╪п╪й</span>
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" data-i18n="mergeSupabaseTitle">╪з╪о╪к┘К╪з╪▒ ┘Е┘Ж ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪▒┘Б┘И╪╣╪й</div>
                            <button class="btn-sm btn-secondary" id="merge-refresh-supa" type="button"><i class="fas fa-sync-alt"></i></button>
                        </div>
                        <div class="card-body stack">
                            <div class="file-list" id="merge-supabase-list"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="section-split" class="section" style="display:none">
                <div class="section-header">
                    <div class="section-title" data-i18n="splitTitle">╪к┘В╪│┘К┘Е / ╪з╪│╪к╪о╪▒╪з╪м ╪╡┘Б╪н╪з╪к</div>
                    <div class="section-subtitle" data-i18n="splitSubtitle">╪е┘Ж╪┤╪з╪б ┘Е┘Д┘Б ╪м╪п┘К╪п ┘К╪н╪к┘И┘К ╪╣┘Д┘Й ╪з┘Д╪╡┘Б╪н╪з╪к ╪з┘Д┘Е╪╖┘Д┘И╪и╪й</div>
                </div>
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" data-i18n="splitSourceTitle">╪з╪о╪к┘К╪з╪▒ ┘Е┘Д┘Б ╪з┘Д┘Е╪╡╪п╪▒</div>
                            <div class="card-subtitle" id="split-selected-file">┘Д┘Е ┘К╪к┘Е ╪з╪о╪к┘К╪з╪▒ ┘Е┘Д┘Б</div>
                        </div>
                        <div class="card-body stack">
                            <div class="two-col">
                                <button class="btn-secondary" id="split-local-btn" data-i18n="btnChooseLocal" type="button"><i class="fas fa-folder-open"></i> ╪з┘Д╪м┘З╪з╪▓</button>
                                <button class="btn-secondary" id="split-supa-refresh" data-i18n="btnChooseSupabase" type="button"><i class="fas fa-database"></i> ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪▒┘Б┘И╪╣╪й</button>
                            </div>
                            <input type="file" id="split-input" accept="application/pdf" style="display:none">
                            <div class="file-list" id="split-supa-list"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header"><div class="card-title" data-i18n="splitPagesTitle">╪к╪н╪п┘К╪п ╪з┘Д╪╡┘Б╪н╪з╪к</div></div>
                        <div class="card-body stack">
                            <div class="input-group">
                                <label class="input-label" for="split-pages-input" data-i18n="splitPagesLabel">┘Ж╪╖╪з┘В ╪з┘Д╪╡┘Б╪н╪з╪к</label>
                                <input class="input" id="split-pages-input" placeholder="┘Е╪л╪з┘Д: 1-3,5,7-8">
                            </div>
                            <button class="btn" id="split-extract-btn" type="button" disabled>
                                <i class="fas fa-cut"></i> <span data-i18n="btnExtractPages">╪з╪│╪к╪о╪▒╪з╪м ╪з┘Д╪╡┘Б╪н╪з╪к ╪з┘Д┘Е╪н╪п╪п╪й</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="section-supabase" class="section" style="display:none">
                <div class="section-header">
                    <div class="section-title" data-i18n="supaTitle">╪е╪п╪з╪▒╪й ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪▒┘Б┘И╪╣╪й</div>
                    <div class="section-subtitle" data-i18n="supaSubtitle">╪з╪│╪к╪╣╪▒╪з╪╢╪М ╪н╪░┘Б╪М ┘И┘Ж╪│╪о ╪з┘Д╪▒┘И╪з╪и╪╖ ┘Е┘Ж ╪з┘Д╪к╪о╪▓┘К┘Ж ╪з┘Д╪│╪н╪з╪и┘К</div>
                </div>
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" data-i18n="supaListTitle">┘В╪з╪ж┘Е╪й ╪з┘Д┘Е┘Д┘Б╪з╪к</div>
                            <button class="btn-sm btn-secondary" id="supa-refresh-btn" type="button"><i class="fas fa-sync-alt"></i> <span data-i18n="btnRefresh">╪к╪н╪п┘К╪л</span></button>
                        </div>
                        <div class="card-body">
                            <div class="file-list" id="supa-list-container"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="section-history" class="section" style="display:none">
                <div class="section-header">
                    <div class="section-title" data-i18n="historyTitle">╪з┘Д╪│╪м┘Д ┘И ╪н╪з┘Д╪й ╪з┘Д╪│┘К╪▒┘Б╪▒</div>
                    <div class="section-subtitle" data-i18n="historySubtitle">┘Е╪к╪з╪и╪╣╪й ╪╣┘Е┘Д┘К╪з╪к┘Г ┘И╪н╪з┘Д╪й ╪з┘Д╪з╪к╪╡╪з┘Д ┘Б┘К ╪з┘Д┘И┘В╪к ╪з┘Д╪н┘В┘К┘В┘К</div>
                </div>
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" data-i18n="historyOpsTitle">╪│╪м┘Д ╪з┘Д╪╣┘Е┘Д┘К╪з╪к</div>
                            <button class="btn-sm btn-secondary" id="history-clear-btn" type="button"><i class="fas fa-eraser"></i> <span data-i18n="btnClearHistory">┘Е╪│╪н ╪з┘Д╪│╪м┘Д</span></button>
                        </div>
                        <div class="card-body">
                            <div class="file-list" id="history-list" style="max-height: 400px;"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" data-i18n="logsTitle">╪│╪м┘Д ╪з┘Д╪г╪н╪п╪з╪л (Console Log)</div>
                            <button class="btn-sm btn-secondary" id="logs-clear-btn" type="button"><i class="fas fa-eraser"></i> <span data-i18n="btnClearLogs">┘Е╪│╪н ╪з┘Д╪│╪м┘Д</span></button>
                        </div>
                        <div class="card-body">
                            <div class="file-list" id="logs-console" style="max-height: 400px; font-family: monospace; font-size: 0.8rem;"></div>
                        </div>
                    </div>
                </div>
            </section>
            
            </main>
    </div>
</div>
<div id="notification-container"></div>

<script type="module">
    // ----------------------------------------------------
    // ** тЪая╕П ╪з┘Д┘Е┘Б╪з╪к┘К╪н ┘И╪з┘Д╪е╪╣╪п╪з╪п╪з╪к (Configuration) тЪая╕П **
    // ----------------------------------------------------
    
    // ** ┘К╪м╪и ╪╣┘Д┘К┘Г ╪к╪║┘К┘К╪▒ ┘З╪░┘З ╪з┘Д┘В┘К┘Е ╪и┘В┘К┘Е Supabase ╪з┘Д╪о╪з╪╡╪й ╪и┘Г **
    const SUPABASE_CONFIG = {
        URL: "https://your-project-ref.supabase.co", // ╪▒╪з╪и╪╖ ┘Е╪┤╪▒┘И╪╣┘Г
        ANON_KEY: "eyJhbGciOiJIUzI1NiI...", // ┘Е┘Б╪к╪з╪н Anon/Public
        // SERVER_URL: "/api/v1", // ┘Ж╪╣┘И╪п ┘Д┘Д╪з╪╣╪к┘Е╪з╪п ╪╣┘Д┘Й ╪з┘Д┘Е╪│╪з╪▒ ╪з┘Д┘И┘З┘Е┘К ╪е╪░╪з ┘Г╪з┘Ж ┘З┘Ж╪з┘Г ╪о╪з╪п┘Е ╪о┘Д┘Б┘К
    };
    
    const BUCKET_NAME = "pdf-files";
    
    // ----------------------------------------------------
    // ** ╪з┘Д╪п┘И╪з┘Д ┘И╪з┘Д┘И╪н╪п╪з╪к ╪з┘Д╪г╪│╪з╪│┘К╪й (Core Modules) **
    // ----------------------------------------------------

    // 1. ╪з┘Д┘И╪н╪п╪й ╪з┘Д╪г╪│╪з╪│┘К╪й ┘Д┘Д╪к╪о╪▓┘К┘Ж (Supabase)
    const SupabaseManager = (function() {
        // ┘К╪к┘Е ╪з╪│╪к╪о╪п╪з┘Е ┘Е┘Г╪к╪и╪й Supabase JS ┘З┘Ж╪з╪М ┘И┘Д┘Г┘Ж ┘Д┘Д╪к╪и╪│┘К╪╖ ╪│┘Ж┘В┘И┘Е ╪и┘Е╪н╪з┘Г╪з╪й ╪з┘Д╪╖┘Д╪и╪з╪к ╪з┘Д┘Е╪и╪з╪┤╪▒╪й
        // ╪з┘Б╪к╪▒╪з╪╢: ┘К╪к┘Е ╪м┘Д╪и ┘Е┘Г╪к╪и╪й Supabase JS ╪╣╪и╪▒ CDN ┘Б┘К ╪к╪╖╪и┘К┘В ┘Б╪╣┘Д┘К
        // <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
        
        let client = null;
        
        function init() {
            // ┘Е╪н╪з┘Г╪з╪й ╪к┘З┘К╪ж╪й ╪╣┘Е┘К┘Д Supabase
            if (typeof window.supabase !== 'undefined') {
                client = window.supabase.createClient(SUPABASE_CONFIG.URL, SUPABASE_CONFIG.ANON_KEY);
            } else {
                UIHelper.logMessage("Supabase JS Library is not loaded. Using manual fetch.", "error");
            }
        }
        
        async function listFiles() {
            UIHelper.logMessage("Fetching file list...");
            const res = await fetch(`${SUPABASE_CONFIG.URL}/storage/v1/object/list/${BUCKET_NAME}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ limit: 100, offset: 0 })
            });
            if (!res.ok) throw new Error("Failed to list files.");
            const files = await res.json();
            return files;
        }

        async function uploadFile(file) {
            const fileName = `${Date.now()}-${file.name.replace(/[^a-zA-Z0-9.-]/g, '_')}`;
            UIHelper.logMessage(`Uploading ${file.name} to ${fileName}...`);
            
            // ┘Е╪н╪з┘Г╪з╪й ╪з┘Д╪▒┘Б╪╣
            const res = await fetch(`${SUPABASE_CONFIG.URL}/storage/v1/object/${BUCKET_NAME}/${fileName}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
                    'Content-Type': file.type,
                    'X-Upsert': 'true'
                },
                body: file
            });
            
            if (!res.ok) {
                const errorText = await res.text();
                throw new Error(errorText || "Upload failed");
            }
            
            const publicUrl = `${SUPABASE_CONFIG.URL}/storage/v1/object/public/${BUCKET_NAME}/${fileName}`;
            return { fileName, publicUrl };
        }

        async function deleteFile(fileName) {
            UIHelper.logMessage(`Deleting file: ${fileName}`);
            const res = await fetch(`${SUPABASE_CONFIG.URL}/storage/v1/object/${BUCKET_NAME}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${SUPABASE_CONFIG.ANON_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ prefixes: [fileName] })
            });

            if (!res.ok) throw new Error("Failed to delete file.");
            return true;
        }
        
        return { init, listFiles, uploadFile, deleteFile };
    })();


    // 2. ┘Г╪з╪ж┘Ж I18N (╪з┘Д╪к╪▒╪м┘Е╪й) - ╪к┘Е ╪е╪о┘Б╪з╪б ╪з┘Д┘Ж╪│╪о╪й ╪з┘Д╪е┘Ж╪м┘Д┘К╪▓┘К╪й ┘Д╪к╪м┘Ж╪и ╪з┘Д╪к┘Г╪▒╪з╪▒
    const i18n = {
      ar: {
        appTitle: "PDF Master Tool",
        appSubtitle: "┘Д┘И╪н╪й ╪к╪н┘Г┘Е ╪з╪н╪к╪▒╪з┘Б┘К╪й ┘Д┘Г┘Д ╪г╪п┘И╪з╪к ╪з┘Д┘А PDF",
        navInfoTitle: "╪н┘И┘Д ┘И╪г╪│╪з╪│┘К╪з╪к",
        navAbout: "╪н┘И┘Д ╪з┘Д╪г╪п╪з╪й",
        aboutTitle: "╪н┘И┘Д PDF Master Tool",
        aboutWelcome: "┘Е╪▒╪н╪и╪з┘Л ╪и┘Г ┘Б┘К ╪г╪п╪з╪й PDF ╪з┘Д╪┤╪з┘Е┘Д╪й!",
        aboutGoal: "┘З╪п┘Б┘Ж╪з ┘З┘И ╪к┘И┘Б┘К╪▒ ┘Е┘Ж╪╡╪й ╪з╪н╪к╪▒╪з┘Б┘К╪й ┘И╪в┘Е┘Ж╪й ┘Д┘Д╪к╪╣╪з┘Е┘Д ┘Е╪╣ ┘Е┘Д┘Б╪з╪к PDF...",
        aboutSecurity: "╪з┘Д╪г┘Е╪з┘Ж ┘И╪з┘Д╪о╪╡┘И╪╡┘К╪й ┘З┘Е╪з ╪г┘И┘Д┘И┘К╪к┘Ж╪з...",
        aboutTip: "┘Д┘Д╪к╪┤╪║┘К┘Д: ╪к╪г┘Г╪п ┘Е┘Ж ╪к╪н╪п┘К╪л ┘Е┘Б╪к╪з╪н ┘И╪╣┘Ж┘И╪з┘Ж Supabase ╪з┘Д╪о╪з╪╡ ╪и┘Г ┘Б┘К ┘Г┘И╪п JavaScript.",
        navCompress: "╪╢╪║╪╖ ╪з┘Д┘Е┘Д┘Б╪з╪к",
        navMerge: "╪п┘Е╪м ╪з┘Д┘Е┘Д┘Б╪з╪к",
        navSplit: "╪к┘В╪│┘К┘Е / ╪з╪│╪к╪о╪▒╪з╪м ╪╡┘Б╪н╪з╪к",
        navText: "╪з╪│╪к╪о╪▒╪з╪м ╪з┘Д┘Ж╪╡",
        navInfo: "┘Е╪╣┘Д┘И┘Е╪з╪к ╪з┘Д┘Е┘Д┘Б",
        navAdvanced: "┘Е╪к┘В╪п┘С┘Е",
        navProtect: "╪н┘Е╪з┘К╪й / ┘Б┘Г ╪з┘Д╪н┘Е╪з┘К╪й",
        navWatermark: "╪з┘Д╪╣┘Д╪з┘Е╪й ╪з┘Д┘Е╪з╪ж┘К╪й",
        navRotate: "╪к╪п┘И┘К╪▒ / ╪е╪╣╪з╪п╪й ╪к╪▒╪к┘К╪и",
        navSystem: "╪з┘Д┘Е┘Д┘Б╪з╪к ┘И╪з┘Д┘Ж╪╕╪з┘Е",
        navSupabase: "╪е╪п╪з╪▒╪й ╪з┘Д┘Е┘Д┘Б╪з╪к",
        navHistory: "╪з┘Д╪│╪м┘Д ┘И ╪з┘Д╪н╪з┘Д╪й",
        compressTitle: "╪╢╪║╪╖ ┘Е┘Д┘Б╪з╪к PDF",
        compressSubtitle: "╪к┘В┘Д┘К┘Д ╪н╪м┘Е ╪з┘Д┘Е┘Д┘Б╪з╪к ╪и╪м┘И╪п╪й ╪╣╪з┘Д┘К╪й",
        compressUploadTitle: "╪▒┘Б╪╣ ┘И╪╢╪║╪╖ ╪з┘Д┘Е┘Д┘Б╪з╪к",
        compressDropTitle: "╪з╪│╪н╪и ┘Е┘Д┘Б╪з╪к PDF ┘З┘Ж╪з ╪г┘И ╪з╪╢╪║╪╖ ┘Д┘Д╪з╪о╪к┘К╪з╪▒",
        compressDropSub: "╪│┘К╪к┘Е ╪з┘Д╪▒┘Б╪╣ ┘И╪з┘Д┘Е╪╣╪з┘Д╪м╪й ╪к┘Д┘В╪з╪ж┘К┘Л╪з",
        mergeTitle: "╪п┘Е╪м ┘Е┘Д┘Б╪з╪к PDF",
        mergeSubtitle: "╪з╪о╪к╪▒ ╪з┘Д┘Е┘Д┘Б╪з╪к ┘И┘В┘Е ╪и╪к╪▒╪к┘К╪и┘З╪з ╪л┘Е ╪п┘Е╪м┘З╪з",
        mergeLocalTitle: "┘Е┘Д┘Б╪з╪к ╪з┘Д╪п┘Е╪м ╪з┘Д┘Е╪н╪п╪п╪й",
        mergeDropSub: "╪з╪╢╪║╪╖ ╪╣┘Д┘Й (+) ┘Д╪е╪╢╪з┘Б╪й ┘Е┘Д┘Б╪з╪к ┘И┘В┘Е ╪и╪│╪н╪и ┘И╪е┘Б┘Д╪з╪к ┘Д╪е╪╣╪з╪п╪й ╪к╪▒╪к┘К╪и┘З╪з.",
        mergeSupabaseTitle: "╪з╪о╪к┘К╪з╪▒ ┘Е┘Ж ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪▒┘Б┘И╪╣╪й",
        btnMerge: "╪п┘Е╪м ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪н╪п╪п╪й",
        btnRefresh: "╪к╪н╪п┘К╪л",
        btnDelete: "╪н╪░┘Б",
        btnCopy: "┘Ж╪│╪о ╪з┘Д╪▒╪з╪и╪╖",
        btnChooseLocal: "╪з┘Д╪м┘З╪з╪▓",
        btnChooseSupabase: "╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪▒┘Б┘И╪╣╪й",
        splitTitle: "╪к┘В╪│┘К┘Е / ╪з╪│╪к╪о╪▒╪з╪м ╪╡┘Б╪н╪з╪к",
        splitSubtitle: "╪е┘Ж╪┤╪з╪б ┘Е┘Д┘Б ╪м╪п┘К╪п ┘К╪н╪к┘И┘К ╪╣┘Д┘Й ╪з┘Д╪╡┘Б╪н╪з╪к ╪з┘Д┘Е╪╖┘Д┘И╪и╪й",
        splitSourceTitle: "╪з╪о╪к┘К╪з╪▒ ┘Е┘Д┘Б ╪з┘Д┘Е╪╡╪п╪▒",
        splitPagesTitle: "╪к╪н╪п┘К╪п ╪з┘Д╪╡┘Б╪н╪з╪к",
        splitPagesLabel: "┘Ж╪╖╪з┘В ╪з┘Д╪╡┘Б╪н╪з╪к",
        btnExtractPages: "╪з╪│╪к╪о╪▒╪з╪м ╪з┘Д╪╡┘Б╪н╪з╪к ╪з┘Д┘Е╪н╪п╪п╪й",
        supaTitle: "╪е╪п╪з╪▒╪й ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д┘Е╪▒┘Б┘И╪╣╪й",
        supaSubtitle: "╪з╪│╪к╪╣╪▒╪з╪╢╪М ╪н╪░┘Б╪М ┘И┘Ж╪│╪о ╪з┘Д╪▒┘И╪з╪и╪╖ ┘Е┘Ж ╪з┘Д╪к╪о╪▓┘К┘Ж ╪з┘Д╪│╪н╪з╪и┘К",
        supaUploadTitle: "╪▒┘Б╪╣ ┘Е┘Д┘Б╪з╪к ╪е┘Д┘Й ╪з┘Д╪к╪о╪▓┘К┘Ж ╪з┘Д╪│╪н╪з╪и┘К",
        supaListTitle: "┘В╪з╪ж┘Е╪й ╪з┘Д┘Е┘Д┘Б╪з╪к",
        historyTitle: "╪з┘Д╪│╪м┘Д ┘И ╪н╪з┘Д╪й ╪з┘Д╪│┘К╪▒┘Б╪▒",
        historySubtitle: "┘Е╪к╪з╪и╪╣╪й ╪╣┘Е┘Д┘К╪з╪к┘Г ┘И╪н╪з┘Д╪й ╪з┘Д╪з╪к╪╡╪з┘Д ┘Б┘К ╪з┘Д┘И┘В╪к ╪з┘Д╪н┘В┘К┘В┘К",
        historyOpsTitle: "╪│╪м┘Д ╪з┘Д╪╣┘Е┘Д┘К╪з╪к",
        btnClearHistory: "┘Е╪│╪н ╪з┘Д╪│╪м┘Д",
        logsTitle: "╪│╪м┘Д ╪з┘Д╪г╪н╪п╪з╪л (Console Log)",
        btnClearLogs: "┘Е╪│╪н ╪з┘Д╪│╪м┘Д",
        statusOnline: "┘Е╪к╪╡┘Д ╪и┘А Supabase",
        statusOffline: "╪о╪╖╪г ┘Б┘К ╪з┘Д╪з╪к╪╡╪з┘Д",
        msgSelectFile: "╪з╪о╪к╪▒ ┘Е┘Д┘Б┘Л╪з ╪г┘И┘Д┘Л╪з",
        msgMinFiles: "╪з╪о╪к╪▒ ┘Е┘Д┘Б┘К┘Ж ╪╣┘Д┘Й ╪з┘Д╪г┘В┘Д",
        msgFileAdded: "╪к┘Е ╪е╪╢╪з┘Б╪й ╪з┘Д┘Е┘Д┘Б ┘Д┘Д┘В╪з╪ж┘Е╪й",
        msgFileSelected: "╪к┘Е ╪з╪о╪к┘К╪з╪▒ ╪з┘Д┘Е┘Д┘Б ╪и┘Ж╪м╪з╪н.",
        msgNoFiles: "┘Д╪з ╪к┘И╪м╪п ┘Е┘Д┘Б╪з╪к ┘Е╪▒┘Б┘И╪╣╪й",
        msgDeleteConfirm: "┘З┘Д ╪г┘Ж╪к ┘Е╪к╪г┘Г╪п ┘Е┘Ж ╪н╪░┘Б ╪з┘Д┘Е┘Д┘Б╪Я",
        msgCopySuccess: "╪к┘Е ┘Ж╪│╪о ╪з┘Д╪▒╪з╪и╪╖ ╪е┘Д┘Й ╪з┘Д╪н╪з┘Б╪╕╪й.",
        
      },
      en: { /* ... (English translations) */ }
    };
    
    // 3. ┘Г╪з╪ж┘Ж UIHelper
    const UIHelper = (function() {
      let currentState = { lang: "ar", theme: localStorage.getItem('theme') || 'dark' };

      function switchLanguage(lang) {
        currentState.lang = lang;
        document.querySelectorAll(".lang-btn").forEach(btn => {
          btn.classList.toggle("active", btn.dataset.lang === lang);
        });
        const dict = i18n[lang];
        document.querySelectorAll("[data-i18n]").forEach(el => {
          const key = el.getAttribute("data-i18n");
          if (dict[key]) el.textContent = dict[key];
        });
        document.body.dir = lang === "ar" ? "rtl" : "ltr";
      }

      function showNotification(message, type = "info", duration = 5000) {
        const container = document.getElementById("notification-container");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), duration + 500); 
      }
      
      function logMessage(message, type = "info") {
        const logsConsole = document.getElementById("logs-console");
        const line = document.createElement("div");
        const time = new Date().toLocaleTimeString();
        const color = type === 'error' ? 'var(--danger)' : (type === 'success' ? 'var(--success)' : 'var(--muted)');
        line.innerHTML = `<span style="color: ${color}">[${time}]</span> ${message}`;
        logsConsole.prepend(line);
        while (logsConsole.children.length > 50) logsConsole.removeChild(logsConsole.lastChild);
      }
      
      function addHistoryEntry(type, fileName, success = true) {
        const historyList = document.getElementById("history-list");
        const entry = document.createElement("div");
        const statusClass = success ? "success" : "error";
        const statusIcon = success ? '<i class="fas fa-check-circle"></i>' : '<i class="fas fa-times-circle"></i>';

        entry.className = `file-item ${statusClass}`;
        entry.innerHTML = `
            <div class="file-item-header">
                <div class="file-name">${type}: ${fileName}</div>
                <div class="file-status" style="color: ${success ? 'var(--success)' : 'var(--danger)'}">${statusIcon}</div>
            </div>
        `;
        historyList.prepend(entry);
        while (historyList.children.length > 30) historyList.removeChild(historyList.lastChild);
      }
      
      function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

      return { switchLanguage, showNotification, logMessage, addHistoryEntry, formatBytes, currentState };
    })();
    
    // 4. ┘Г╪з╪ж┘Ж Theme (╪з┘Д┘И╪╢╪╣ ╪з┘Д┘Е╪╕┘Д┘Е/╪з┘Д┘Б╪з╪к╪н)
    const ThemeModule = (function() {
      const body = document.body;
      const toggleButton = document.getElementById("theme-toggle");
      const icon = document.getElementById("theme-icon");

      function applyTheme(theme) {
          body.classList.toggle('light-theme', theme === 'light');
          icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
          localStorage.setItem('theme', theme);
          UIHelper.currentState.theme = theme;
      }

      function toggleTheme() {
          const newTheme = UIHelper.currentState.theme === 'dark' ? 'light' : 'dark';
          applyTheme(newTheme);
      }

      function init() {
          applyTheme(UIHelper.currentState.theme);
          toggleButton.addEventListener('click', toggleTheme);
      }
      
      return { init };
    })();

    // 5. ┘И╪╕╪з╪ж┘Б ╪з┘Д┘Е╪│╪з╪╣╪п╪з╪к ┘Д┘Д┘А DOM (╪▒╪и╪╖ ╪│╪н╪и ┘И╪е┘Б┘Д╪з╪к╪М ╪е┘Д╪о)
    function wireFileDrop(dropEl, inputEl, onFiles) {
        dropEl.addEventListener("click", () => inputEl.click());
        dropEl.addEventListener("dragover", e => {
          e.preventDefault();
          dropEl.classList.add("dragover");
        });
        dropEl.addEventListener("dragleave", () => dropEl.classList.remove("dragover"));
        dropEl.addEventListener("drop", e => {
          e.preventDefault();
          dropEl.classList.remove("dragover");
          if (e.dataTransfer.files && e.dataTransfer.files.length) {
            onFiles(e.dataTransfer.files);
          }
        });
        inputEl.addEventListener("change", e => {
          if (e.target.files && e.target.files.length) {
            onFiles(e.target.files);
          }
        });
    }

    // 6. ╪п╪з┘Д╪й ╪м┘Д╪и ┘И╪╣╪▒╪╢ ┘В╪з╪ж┘Е╪й Supabase
    async function renderSupabaseList(targetEl, actionType = 'files') {
        targetEl.innerHTML = `<div class="file-drop-sub">${i18n[UIHelper.currentState.lang].btnRefresh}...</div>`;
        try {
            const files = await SupabaseManager.listFiles(); 
            
            targetEl.innerHTML = "";
            if (files.length === 0) {
                targetEl.textContent = i18n[UIHelper.currentState.lang].msgNoFiles;
                return;
            }
            
            files.forEach(file => {
                if (file.name === '.emptyFolderPlaceholder') return;
                const fileName = file.name;
                const publicUrl = `${SUPABASE_CONFIG.URL}/storage/v1/object/public/${BUCKET_NAME}/${fileName}`;
                const sizeDisplay = UIHelper.formatBytes(file.metadata.size);

                const el = document.createElement("div");
                el.className = "file-item";
                el.setAttribute('data-filename', fileName);
                el.innerHTML = `
                    <div class="file-item-header">
                        <div class="file-name">${fileName}</div>
                        <div class="row" style="display:flex; gap: 8px;">
                            ${actionType === 'files' ? `<button class="btn-sm btn-secondary copy-btn"><i class="fas fa-copy"></i></button>
                                                       <button class="btn-sm btn-secondary delete-btn" style="background: var(--danger); color: white;"><i class="fas fa-trash-alt"></i></button>` : 
                                                       `<button class="btn-sm btn-secondary select-btn"><i class="fas fa-plus"></i></button>`}
                        </div>
                    </div>
                    <div class="file-meta">
                        <span>${sizeDisplay}</span>
                        <span>${new Date(file.created_at).toLocaleDateString()}</span>
                    </div>
                `;

                if (actionType === 'files') {
                    // ┘Е┘Ж╪╖┘В ╪з┘Д╪н╪░┘Б ┘И╪з┘Д┘Ж╪│╪о
                    el.querySelector(".copy-btn").addEventListener("click", async () => {
                        await navigator.clipboard.writeText(publicUrl);
                        UIHelper.showNotification(i18n[UIHelper.currentState.lang].msgCopySuccess, "success");
                        UIHelper.logMessage(`Copied URL for: ${fileName}`);
                    });
                    
                    el.querySelector(".delete-btn").addEventListener("click", async () => {
                        if (!confirm(i18n[UIHelper.currentState.lang].msgDeleteConfirm)) return;
                        try {
                            await SupabaseManager.deleteFile(fileName);
                            el.remove();
                            UIHelper.addHistoryEntry("Delete", fileName, true);
                            UIHelper.showNotification("File deleted successfully.", "success");
                        } catch (e) {
                            UIHelper.showNotification("Deletion failed: " + e.message, "error");
                            UIHelper.addHistoryEntry("Delete", fileName, false);
                        }
                    });
                } else if (actionType === 'merge') {
                    // ┘Е┘Ж╪╖┘В ╪з┘Д╪з╪о╪к┘К╪з╪▒ ┘Д┘Д╪п┘Е╪м
                    el.querySelector(".select-btn").addEventListener("click", () => {
                        handleMergeSelection({ name: fileName, publicUrl, size: file.metadata.size });
                        UIHelper.logMessage(`Selected for Merge: ${fileName}`);
                    });
                }
                
                targetEl.appendChild(el);
            });
            
        } catch (e) {
            targetEl.textContent = i18n[UIHelper.currentState.lang].statusOffline;
            UIHelper.showNotification(i18n[UIHelper.currentState.lang].statusOffline, "error");
        }
    }


    // ----------------------------------------------------
    // ** ┘Е┘Ж╪╖┘В ╪г┘В╪│╪з┘Е ╪з┘Д╪к╪╖╪и┘К┘В (Application Logic) **
    // ----------------------------------------------------
    
    // ** ╪н╪з┘Д╪й ╪з┘Д╪к╪╖╪и┘К┘В ╪з┘Д╪о╪з╪╡╪й ╪и╪з┘Д╪п┘Е╪м **
    let mergeSources = [];

    // ** ╪п┘И╪з┘Д ╪з┘Д╪п┘Е╪м **
    const renderMergeList = () => {
        const mergeListEl = document.getElementById("merge-file-list");
        mergeListEl.innerHTML = '';
        if (mergeSources.length === 0) {
            mergeListEl.innerHTML = `<div class="file-drop-sub" style="margin-top: 0;" data-i18n="mergeDropSub">╪з╪╢╪║╪╖ ╪╣┘Д┘Й (+) ┘Д╪е╪╢╪з┘Б╪й ┘Е┘Д┘Б╪з╪к ┘И┘В┘Е ╪и╪│╪н╪и ┘И╪е┘Б┘Д╪з╪к ┘Д╪е╪╣╪з╪п╪й ╪к╪▒╪к┘К╪и┘З╪з.</div>`;
        }
        
        mergeSources.forEach((source, index) => {
            const el = document.createElement('div');
            el.className = 'file-item';
            el.draggable = true;
            el.innerHTML = `
                <div class="file-item-header">
                    <div class="file-name">(${index + 1}) ${source.name}</div>
                    <button class="btn-sm btn-secondary remove-btn" data-index="${index}"><i class="fas fa-times"></i></button>
                </div>
            `;
            el.querySelector('.remove-btn').addEventListener('click', () => {
                mergeSources.splice(index, 1);
                renderMergeList();
            });
            mergeListEl.appendChild(el);
        });
        
        document.getElementById("merge-btn").disabled = mergeSources.length < 2;
        
        // ╪▒╪и╪╖ ╪з┘Д╪│╪н╪и ┘И╪з┘Д╪е┘Б┘Д╪з╪к ┘Д╪е╪╣╪з╪п╪й ╪з┘Д╪к╪▒╪к┘К╪и (┘Д┘Д╪к╪╖╪и┘К┘В ╪з┘Д┘Г╪з┘Е┘Д)
    };

    const handleMergeSelection = (fileInfo) => {
        // ╪з┘Д╪к╪н┘В┘В ┘Е┘Ж ╪з┘Д╪к┘Г╪▒╪з╪▒
        if (mergeSources.some(f => f.name === fileInfo.name)) {
            UIHelper.showNotification(`File ${fileInfo.name} is already in the list.`, "info");
            return;
        }
        mergeSources.push(fileInfo);
        renderMergeList();
        UIHelper.showNotification(i18n[UIHelper.currentState.lang].msgFileAdded, "success");
    };

    // ** ╪п┘И╪з┘Д ┘Е╪╣╪з┘Д╪м╪й ╪з┘Д╪г┘В╪│╪з┘Е ╪г╪н╪з╪п┘К╪й ╪з┘Д┘Е╪╡╪п╪▒ (Split / Compress / etc.) **
    let currentSource = { url: null, name: null };
    
    function wireSourceSelection(localBtn, inputEl, supaRefreshBtn, statusEl, processBtn) {
        
        const updateUI = (name, url) => {
            currentSource.name = name;
            currentSource.url = url;
            statusEl.textContent = name || i18n[UIHelper.currentState.lang].splitSourceSubtitle;
            if (processBtn) processBtn.disabled = !url;
        };
        
        // ╪з┘Д╪з╪о╪к┘К╪з╪▒ ┘Е┘Ж ╪з┘Д╪м┘З╪з╪▓
        localBtn.addEventListener("click", () => inputEl.click());
        inputEl.addEventListener("change", async e => {
            const f = e.target.files[0];
            if (!f) return;
            try {
                const { publicUrl, fileName } = await SupabaseManager.uploadFile(f);
                updateUI(fileName, publicUrl);
                UIHelper.showNotification(i18n[UIHelper.currentState.lang].msgFileSelected, "success");
            } catch (err) {
                UIHelper.showNotification("Upload failed: " + err.message, "error");
            }
        });
        
        // ╪з┘Д╪з╪о╪к┘К╪з╪▒ ┘Е┘Ж Supabase
        supaRefreshBtn.addEventListener("click", () => {
            const listContainer = document.getElementById('split-supa-list'); // ┘К╪к┘Е ╪к╪║┘К┘К╪▒ ╪з┘Д┘А ID ╪и┘Ж╪з╪б┘Л ╪╣┘Д┘Й ╪з┘Д┘В╪│┘Е
            renderSupabaseList(listContainer, 'select').then(() => {
                listContainer.querySelectorAll('.select-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const fileName = btn.closest('.file-item').getAttribute('data-filename');
                        const publicUrl = `${SUPABASE_CONFIG.URL}/storage/v1/object/public/${BUCKET_NAME}/${fileName}`;
                        updateUI(fileName, publicUrl);
                        listContainer.innerHTML = `<div class="file-drop-sub">${i18n[UIHelper.currentState.lang].msgFileSelected}</div>`;
                    });
                });
            });
        });

        // ╪е╪▒╪м╪з╪╣ ┘И╪╕┘К┘Б╪й ┘Д╪е╪╣╪з╪п╪й ╪╢╪и╪╖ ╪н╪з┘Д╪й ╪з┘Д┘Е╪╡╪п╪▒
        return { 
            getSource: () => currentSource, 
            reset: () => updateUI(null, null) 
        };
    }

    // ** ┘Е╪н╪з┘Г╪з╪й ╪╖┘Д╪и╪з╪к ┘Е╪╣╪з┘Д╪м╪й ╪з┘Д┘А PDF (╪з┘Д╪к┘К ┘К╪м╪и ╪г┘Ж ╪к╪к┘Е ╪╣╪и╪▒ ╪о╪з╪п┘Е ╪о┘Д┘Б┘К) **
    async function simulatePdfProcess(operation, url, filename, options = {}) {
        UIHelper.logMessage(`Processing ${operation} for ${filename}...`, 'info');
        UIHelper.showNotification(`Starting ${operation} process...`, 'info');

        // ┘Б┘К ╪к╪╖╪и┘К┘В ┘Б╪╣┘Д┘К╪М ┘З┘Ж╪з ┘К╪к┘Е ╪е╪▒╪│╪з┘Д ╪╖┘Д╪и HTTP ╪е┘Д┘Й ╪з┘Д╪о╪з╪п┘Е ╪з┘Д╪о┘Д┘Б┘К
        // const res = await fetch(SUPABASE_CONFIG.SERVER_URL + '/' + operation, { ... });
        
        // ┘Е╪н╪з┘Г╪з╪й ╪к╪г╪о┘К╪▒ ╪з┘Д┘Е╪╣╪з┘Д╪м╪й
        await new Promise(resolve => setTimeout(resolve, 2000)); 
        
        // ┘Е╪н╪з┘Г╪з╪й ╪к┘Ж╪▓┘К┘Д ╪з┘Д┘Е┘Д┘Б
        const mockBlob = new Blob(["Mock PDF content"], { type: "application/pdf" });
        const downloadUrl = URL.createObjectURL(mockBlob);
        const a = document.createElement("a");
        a.href = downloadUrl;
        a.download = `${operation}-${filename}`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(downloadUrl);
        
        UIHelper.addHistoryEntry(operation, filename, true);
        UIHelper.showNotification(`${operation} completed and file downloaded!`, "success");
    }

    // ----------------------------------------------------
    // ** ╪к┘З┘К╪ж╪й ╪з┘Д╪к╪╖╪и┘К┘В (Initialization) **
    // ----------------------------------------------------
    (function initApp() {
        // 1. ╪к┘З┘К╪ж╪й ╪з┘Д╪л┘К┘Е ┘И╪з┘Д┘Д╪║╪й
        ThemeModule.init();
        UIHelper.switchLanguage(UIHelper.currentState.lang);
        document.querySelectorAll(".lang-btn").forEach(btn => {
          btn.addEventListener("click", () => UIHelper.switchLanguage(btn.dataset.lang));
        });
        
        // 2. ┘Б╪н╪╡ ╪н╪з┘Д╪й ╪з┘Д╪з╪к╪╡╪з┘Д (Supabase)
        SupabaseManager.init();
        SupabaseManager.listFiles().then(() => {
            document.getElementById("statusDot").classList.add("online");
            document.getElementById("statusText").textContent = i18n[UIHelper.currentState.lang].statusOnline;
            UIHelper.logMessage("Supabase connection OK.", "success");
        }).catch(e => {
            document.getElementById("statusDot").classList.remove("online");
            document.getElementById("statusText").textContent = i18n[UIHelper.currentState.lang].statusOffline;
            UIHelper.logMessage("Supabase connection failed. Check keys.", "error");
        });
        
        // 3. ╪к┘Б╪╣┘К┘Д ╪з┘Д╪к┘Ж┘В┘Д ╪з┘Д╪м╪з┘Ж╪и┘К
        document.querySelectorAll(".nav-item").forEach(item => {
          item.addEventListener("click", () => {
            const section = item.dataset.section;
            document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
            item.classList.add("active");
            document.querySelectorAll("main .section").forEach(sec => {
              sec.style.display = sec.id === `section-${section}` ? "block" : "none";
            });
            // ╪е╪░╪з ┘Г╪з┘Ж ╪з┘Д┘В╪│┘Е ┘З┘И Supabase╪М ┘В┘Е ╪и╪к╪н┘Е┘К┘Д ╪з┘Д┘В╪з╪ж┘Е╪й
            if (section === 'supabase') document.getElementById("supa-refresh-btn").click();
          });
        });
        document.querySelector('.nav-item[data-section="about"]').click();
        
        // 4. ╪▒╪и╪╖ ╪з┘Д╪г╪▓╪▒╪з╪▒ ┘И╪з┘Д┘И╪╕╪з╪ж┘Б

        // ** A. ╪з┘Д╪│╪м┘Д ┘И╪з┘Д╪к┘Ж╪╕┘К┘Б **
        document.getElementById("logs-clear-btn").addEventListener("click", () => document.getElementById("logs-console").innerHTML = "");
        document.getElementById("history-clear-btn").addEventListener("click", () => document.getElementById("history-list").innerHTML = "");


        // ** B. ╪е╪п╪з╪▒╪й ╪з┘Д┘Е┘Д┘Б╪з╪к (Supabase) **
        document.getElementById("supa-refresh-btn").addEventListener("click", () => {
            renderSupabaseList(document.getElementById("supa-list-container"), 'files');
        });

        // ** C. ╪з┘Д╪╢╪║╪╖ (Compress) **
        wireFileDrop(document.getElementById("compress-drop"), document.getElementById("compress-input"), async (files) => {
            for (const file of files) {
                try {
                    const { publicUrl, fileName } = await SupabaseManager.uploadFile(file);
                    await simulatePdfProcess("Compress", publicUrl, fileName);
                } catch (e) {
                    UIHelper.showNotification(`Compression failed for ${file.name}: ${e.message}`, "error");
                    UIHelper.addHistoryEntry("Compress", file.name, false);
                }
            }
        });
        
        // ** D. ╪з┘Д╪п┘Е╪м (Merge) **
        document.getElementById("merge-add-file").addEventListener("click", () => document.getElementById("merge-input").click());
        document.getElementById("merge-input").addEventListener("change", async (e) => {
            for (const file of e.target.files) {
                try {
                    const { publicUrl, fileName } = await SupabaseManager.uploadFile(file);
                    handleMergeSelection({ name: fileName, publicUrl, size: file.size });
                } catch (err) {
                    UIHelper.showNotification(`Upload failed for ${file.name}: ${err.message}`, "error");
                }
            }
            e.target.value = null;
        });

        document.getElementById("merge-refresh-supa").addEventListener("click", () => {
             renderSupabaseList(document.getElementById("merge-supabase-list"), 'merge');
        });

        document.getElementById("merge-btn").addEventListener("click", () => {
            if (mergeSources.length < 2) {
                UIHelper.showNotification(i18n[UIHelper.currentState.lang].msgMinFiles, "info");
                return;
            }
            // ┘Е╪н╪з┘Г╪з╪й ╪п┘Е╪м ╪з┘Д┘Е┘Д┘Б╪з╪к ╪з┘Д╪к┘К ╪к┘Е ╪з╪о╪к┘К╪з╪▒┘З╪з (MergeSources)
            const combinedName = mergeSources.map(f => f.name.substring(0, 5)).join('-') + '_merged.pdf';
            simulatePdfProcess("Merge", null, combinedName, { urls: mergeSources.map(s => s.publicUrl) });
        });
        
        // ** E. ╪з┘Д╪к┘В╪│┘К┘Е (Split) **
        const splitSource = wireSourceSelection(
            document.getElementById("split-local-btn"), document.getElementById("split-input"),
            document.getElementById("split-supa-refresh"), document.getElementById("split-selected-file"), 
            document.getElementById("split-extract-btn")
        );
        
        document.getElementById("split-extract-btn").addEventListener("click", () => {
            const source = splitSource.getSource();
            const pages = document.getElementById("split-pages-input").value.trim();
            if (!source.url || !pages) {
                UIHelper.showNotification("Please select a file and enter pages range.", "info");
                return;
            }
            simulatePdfProcess("Split", source.url, `${source.name.split('.')[0]}_split.pdf`, { pages });
        });
    })();
</script>
</body>
</html>
